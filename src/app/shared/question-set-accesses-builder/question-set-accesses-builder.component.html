<div>
    <div class="dialog-container">
        <h1>{{ "students.assignQuestionSet" | translate }} <span *ngIf="libraryAssessment">: {{assessment.title}}</span> </h1>
        <div mat-dialog-close class="close-dialog-button">
            <mat-icon>close</mat-icon>
        </div>
        <div class="question-set-accesses-builder">
            <div class="question-set-accesses-builder__list -students" *ngIf="this.libraryAssessment || studentsList.length">
                <span class="header">{{ "general.students" | translate }}</span>
                <div *ngIf="!libraryAssessment">
                    <div class="question-set-accesses-builder__list-row" *ngFor="let student of studentsList">
                        <mat-icon color="accent">person</mat-icon>
                        <span>{{ student.full_name }}</span>
                    </div>
                </div>
                <div *ngIf="libraryAssessment" [formGroup]="assignStudentsForm">
                    <ng-container formArrayName="students">
                        <app-spinner *ngIf="loadingStudents" style="text-align: -webkit-center;" size="small" [variant]="'primary'"></app-spinner>
                        <span class="notifier" *ngIf="!studentsList.length && !loadingStudents">
                            {{ 'students.questionSetAccessesBuilder.noStudentsGrades' | translate: {gradeNumber: assessment.grade} }}
                        </span>

                        <div *ngFor="let control of studentControls; let i=index;" [formGroupName]="i"
                            class="question-set-accesses-builder__list-row -question-set-access">
                            <mat-checkbox formControlName="selected" (change)="uniqueAssessmentCheck(control, $event.checked)">
                                {{ control.get('student').value.full_name }}
                            </mat-checkbox>
                        </div>
                    </ng-container>
                </div>
            </div>

            <div [formGroup]="assignGroupForm" class="question-set-accesses-builder__list">
                <span class="header">
                    {{ "general.groups" | translate }}
                    <mat-icon *ngIf="groupsList.length" matTooltip="{{ 'students.questionSetAccessesBuilder.groupsInfo' | translate }}">info_outline</mat-icon>
                </span>
                <span class="notifier" *ngIf="!groupsList.length"> {{ 'students.questionSetAccessesBuilder.noGroups' | translate }} </span>
                <ng-container formArrayName="groups">
                    <div *ngFor="let control of groupControls; let i=index;" [formGroupName]="i"
                        class="question-set-accesses-builder__list-row -question-set-access">
                        <mat-checkbox formControlName="selected">
                            {{ control.get('group').value.name }}
                        </mat-checkbox>
                    </div>
                </ng-container>
            </div>

            <div *ngIf="!libraryAssessment" class="question-set-accesses-builder__list">
                <span class="header">{{ "students.questionSetAccessesBuilder.assessment" | translate }}</span>

                <mat-radio-button class="question-set-accesses-builder__list-row -assessment" title="{{ assessment.title }}" *ngFor="let assessment of assessmentsList"
                    value="{{ assessment.id }}" (change)="loadQuestionSetsList(assessment.id.toString())">{{ assessment.title }}
                </mat-radio-button>
            </div>

            <div [formGroup]="assignQuestionSetForm" class="question-set-accesses-builder__list">
                <span class="header">
                    {{ "students.questionSetAccessesBuilder.questionSetAvailability" | translate }}
                </span>
                <ng-container formArrayName="access">
                    <div class="question-set-accesses-builder__list__set-dates" *ngIf="questionSetControls && questionSetControls.length">
                        <mat-form-field color="accent" appearance="outline">
                            <mat-date-range-input [rangePicker]="setUpDateForAll" [min]="minDate">
                                <input (dateInput)="onDateInput('start_date', $event.value)" matStartDate [placeholder]="'students.questionSetAccessesBuilder.startDate' | translate">
                                <input (dateInput)="onDateInput('end_date', $event.value)" matEndDate [placeholder]="'students.questionSetAccessesBuilder.endDate' | translate">
                            </mat-date-range-input>
                            <mat-datepicker-toggle matSuffix [for]="setUpDateForAll"></mat-datepicker-toggle>
                            <mat-date-range-picker #setUpDateForAll></mat-date-range-picker>
                        </mat-form-field>
                        <div class="apply-all">
                            <mat-checkbox (change)="onApplyToAllQuestionSets($event.checked)" [disabled]="!startDate || !endDate">
                                {{ "students.questionSetAccessesBuilder.applySameDatesAllQuestionSets" | translate }}
                            </mat-checkbox>
                        </div>
                    </div>
                    <div *ngFor="let control of questionSetControls; let i=index;" [formGroupName]="i"
                        class="question-set-accesses-builder__list-row -question-set-access">

                        <mat-checkbox formControlName="selected" (change)="selectQuestionSet(control, $event.checked)">
                            {{ control.get('question_set').value.name }}
                        </mat-checkbox>

                        <mat-form-field color="accent" appearance="outline">
                            <mat-date-range-input [rangePicker]="campaignOnePicker" [min]="minDate">
                                <input matStartDate formControlName="start_date" [placeholder]="'students.questionSetAccessesBuilder.startDate' | translate">
                                <input matEndDate formControlName="end_date" [placeholder]="'students.questionSetAccessesBuilder.endDate' | translate">
                            </mat-date-range-input>
                            <mat-datepicker-toggle matSuffix [for]="campaignOnePicker"></mat-datepicker-toggle>
                            <mat-date-range-picker #campaignOnePicker></mat-date-range-picker>
                        </mat-form-field>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>
</div>
<div class="dialog-buttons">
    <span class="notifier" *ngIf="disabledAssign"> {{ 'students.questionSetAccessesBuilder.notifier' | translate }} </span>
    <button mat-flat-button mat-dialog-close class="dialog-buttons__cancel" color="secondary">
        {{ "general.close" | translate }}
    </button>
    <button mat-flat-button class="dialog-buttons__submit" [disabled]="!questionSetControls.length || assignQuestionSetForm.invalid || disabledAssign" color="accent"
    (click)="submitCreateQuestionSetAccesses()" mat-dialog-close>
        {{ "general.assign" | translate }}
    </button>
</div>