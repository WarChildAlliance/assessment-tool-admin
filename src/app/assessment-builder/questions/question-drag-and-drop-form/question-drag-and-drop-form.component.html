<div class="container">

    <form [formGroup]="dragAndDropForm">
        <div class="drag-and-drop-form">
            <div>
                <mat-form-field appearance="outline" color="accent">
                    <mat-label>{{ "general.title" | translate }}</mat-label>
                    <input matInput required type="text" formControlName="title">
                </mat-form-field>
                <mat-form-field appearance="outline" color="accent">
                    <mat-label>{{ "general.order" | translate }}</mat-label>
                    <input matInput required type="number" formControlName="order">
                </mat-form-field>
            </div>

            <div class="form-button" *ngIf="dragAndDropForm.controls.drop_areas.invalid">
                <app-custom-button category="tertiary" variant="secondary" (click)="openDragAndDrop()" variant="default">
                    Select background image and drop areas
                </app-custom-button>
                <span class="notifier">
                    Please define the background image and the drop areas to proceed
                </span>
            </div>

            <div class="form-button" *ngIf="setDragItems">
                <app-custom-button category="tertiary" variant="secondary" [disabled]="!confirmDraggable"
                (click)="onSetDraggableItems()" variant="default">
                    Select draggable items
                </app-custom-button>

                <span class="notifier">
                    <span>
                        Please set the draggable items and click the button above when finished
                    </span>
                    <mat-icon matTooltip="Select the area(s) where the draggable item is valid and load the image. For draggable items without a valid area: just load the image without selecting anything.">
                    help_outline</mat-icon>
                </span>
            </div>
        </div>

        <div class="area-container" *ngIf="setDragItems">
            <div class="left">
                <span>
                    <p>Areas:</p>
                </span>
                <div class="area" *ngFor="let area of dragAndDropForm.controls.drop_areas.value; let i = index;">
                    <div class="area-name">
                        <mat-checkbox color="accent" (click)="$event.stopPropagation()" (change)="selection.toggle(i)"
                            [checked]="selection.isSelected(i)">
                                {{area.name}}
                        </mat-checkbox>
                        
                        <div *ngIf="dragItemsArea[i].attachments.length">
                            <div class="items-container" *ngFor="let item of dragItemsArea[i].attachments; let j = index;">
                                <app-custom-button matTooltip="Delete item" [isIcon]="true" icon="remove_circle_outline" (click)="removeArea(dragItemsArea[i].attachments, i)">
                                </app-custom-button>
                                {{item.file.name}}
                            </div>
                            <mat-divider></mat-divider>
                        </div>
                    </div>
                </div>

                <div class="without-area">
                    <span>
                        <p>Draggable items without valid area:</p>
                    </span>
                    <div class="list" *ngFor="let item of dragItems; let k = index;">
                        <app-custom-button matTooltip="Delete item" [isIcon]="true" icon="remove_circle_outline" (click)="removeArea(dragItems, k)">
                        </app-custom-button>
                        {{item.file.name}}
                    </div>
                </div>
            </div>

            <div class="items-selectors">
                <div>
                    <app-image-selector [reset$]="attachmentsResetSubject$.asObservable()"
                        (newImageEvent)="handleFileInputOptions($event, 'IMAGE', selection.selected)"></app-image-selector>
                </div>
            </div>
        </div>

        <mat-divider></mat-divider>

        <h2>Question Attachments</h2>
        <div class="attachments-container">
            <div>
                <app-image-selector [reset$]="attachmentsResetSubject$.asObservable()"
                    (newImageEvent)="onNewImageAttachment($event)" [imageAttachment]="imageAttachment">
                </app-image-selector>
            </div>
            <div>
                <app-audio-selector [isRecorderEnabled]="true" [reset$]="attachmentsResetSubject$.asObservable()"
                    (newAudioEvent)="onNewAudioAttachment($event)" [audioAttachment]="audioAttachment">
                </app-audio-selector>
            </div>
        </div>

    </form>
</div>

<div class="dialog-buttons">
    <button mat-flat-button mat-dialog-close class="dialog-buttons__cancel" color="secondary">
        {{ "general.cancel" | translate }}
    </button>
    <button mat-flat-button [mat-dialog-close]="true" color="accent"
        [disabled]="dragAndDropForm.invalid || !dragAndDropForm.dirty" (click)="onSubmit()">
        {{ question ? toClone ? ("general.clone" | translate) : ("general.save" | translate) : ("general.create" |
        translate) }}
    </button>
</div>