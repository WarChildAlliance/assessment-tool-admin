<div class="question-list-container" *ngIf="topicDetails">
  <div class="topic-header">
    <img *ngIf="topicDetails?.icon" [src]="topicDetails.icon">
    <h1>{{ topicDetails.name }}</h1>
    <app-custom-button *ngIf="topicDetails.can_edit" category="tertiary" variant="primary"
     icon="edit" (click)="openEditTopicDialog(topicDetails)">
      Edit
    </app-custom-button>
  </div>
  <mat-card>
    <div class="topic-infos" *ngIf="topicDetails">
      <div class="detail">
        <p>Description</p>
        <p>{{ topicDetails.description}} </p>
      </div>
      <div class="detail">
        <p>Evaluated</p>
        <p>{{ topicDetails.evaluated}} </p>
      </div>
      <div class="detail">
        <p>Allow skip</p>
        <p>{{ topicDetails.allow_skip}} </p>
      </div>
      <div class="detail">
        <p>Max wrong answer</p>
        <p>{{ topicDetails.max_wrong_answers}} </p>
      </div>
      <div class="detail">
        <p>Praise</p>
        <p>{{ topicDetails.praise }} </p>
      </div>
      <div class="detail">
        <p>Show feedback</p>
        <p>{{ topicDetails.show_feedback }} </p>
      </div>
    </div>
  </mat-card>
  <div class="question">
    <mat-card *ngIf="topicDetails.can_edit">
      <h2>Add {{ questionType === 'INPUT' ? 'an' : 'a'}} {{ questionType.toLowerCase() }} question</h2>
      <div class="question-options" *ngIf="questionType && order">
        <div class="question-options-button">
          <app-custom-button *ngFor="let question of questionsArray" category="tertiary" variant="primary"
            (click)="setQuestionType(question.type)" [variant]="questionType === question.type ? 'neutral' : 'default'">
            {{ question.text }}
          </app-custom-button>
        </div>
        <hr>
        <div class="question-form">
          <app-question-select-form [assessmentId]="assessmentId" [topicId]="topicId" [order]="order"
            *ngIf="questionType === 'SELECT'" (questionCreatedEvent)="getQuestionsList()"></app-question-select-form>
          <app-question-input-form [assessmentId]="assessmentId" [topicId]="topicId" [order]="order"
            *ngIf="questionType === 'INPUT'" (questionCreatedEvent)="getQuestionsList()"></app-question-input-form>
          <app-question-numberline-form [assessmentId]="assessmentId" [topicId]="topicId" [order]="order"
            *ngIf="questionType === 'NUMBER_LINE'" (questionCreatedEvent)="getQuestionsList()"></app-question-numberline-form>
        </div>
      </div>
    </mat-card>
    <div class="question-details" *ngFor="let questionDetails of questionsList">
      <app-custom-button *ngIf="topicDetails.can_edit" category="tertiary" variant="neutral" (click)="onEditQuestionDialog(questionDetails)">
        Edit
      </app-custom-button>
      <app-custom-button *ngIf="topicDetails.can_edit" category="tertiary" variant="neutral" (click)="cloneQuestion(questionDetails)">
        Clone
      </app-custom-button>
      <mat-card *ngIf="questionDetails && questionDetails.question_type === 'SELECT'">
        <app-question-select [question]="questionDetails" [index]="1" [evaluated]="true"></app-question-select>
      </mat-card>

      <mat-card *ngIf="questionDetails && questionDetails.question_type === 'INPUT'">
        <app-question-input [question]="questionDetails" [index]="1" [evaluated]="true"></app-question-input>
      </mat-card>

      <mat-card *ngIf="questionDetails && questionDetails.question_type === 'SORT'">
        <app-question-sort [question]="questionDetails" [index]="1" [evaluated]="true"></app-question-sort>
      </mat-card>

      <mat-card *ngIf="questionDetails && questionDetails.question_type === 'NUMBER_LINE'">
        <app-question-numberline [question]="questionDetails" [index]="1" [evaluated]="true">
        </app-question-numberline>
      </mat-card>
    </div>
  </div>
</div>

<ng-template #createTopicDialog>
  <mat-dialog-content>
    <app-topic-form-dialog [assessmentId]="assessmentId" [topic]="topic" [edit]="true"></app-topic-form-dialog>
  </mat-dialog-content>
</ng-template>

<ng-template #editQuestionDialog>
  <mat-dialog-content>
    <app-question-input-form [assessmentId]="assessmentId" [topicId]="topicId" [order]="order" 
    [question]="question" [toClone]="toClone" (closeModalEvent)="onCloseModal()"
      *ngIf="question.question_type === 'INPUT'"></app-question-input-form>
    <app-question-numberline-form [assessmentId]="assessmentId" [topicId]="topicId" 
    [question]="question" [toClone]="toClone" (closeModalEvent)="onCloseModal()"
      *ngIf="question.question_type === 'NUMBER_LINE'"></app-question-numberline-form>
    <app-question-select-form [assessmentId]="assessmentId" [topicId]="topicId" 
    [question]="question" [toClone]="toClone" (closeModalEvent)="onCloseModal()"
      *ngIf="question.question_type === 'SELECT'"></app-question-select-form>
  </mat-dialog-content>
</ng-template>